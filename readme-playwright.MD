# ğŸ§ª Playwright API Testing - ServeRest

[![Playwright](https://img.shields.io/badge/Playwright-Java-45ba63.svg)](https://playwright.dev/java/)
[![JUnit5](https://img.shields.io/badge/JUnit-5.10.1-green.svg)](https://junit.org/junit5/)
[![Java](https://img.shields.io/badge/Java-21-orange.svg)](https://www.oracle.com/java/)

Projeto de automaÃ§Ã£o de testes de API utilizando **Microsoft Playwright para Java** para testar a API REST **ServeRest** - uma API gratuita que simula uma loja virtual.

Projeto estruturado com boas prÃ¡ticas, exemplos de testes, validaÃ§Ãµes avanÃ§adas e integraÃ§Ã£o com JUnit 5 para execuÃ§Ã£o e relatÃ³rios.

URI do repositÃ³rio: [https://github.com/reinaldorossetti/karate_api_java](https://github.com/reinaldorossetti/karate_api_java)

Reporte na esteira: [https://reinaldorossetti.github.io/karate_api_java/allure-reports/index.html](https://reinaldorossetti.github.io/karate_api_java/allure-reports/index.html)

Testes realizados na API: [TESTING_API.MD](TESTING_API.MD)

---

## ğŸ“š Ãndice

- [Sobre o Playwright](#-sobre-o-playwright)
- [Sobre a API ServeRest](#-sobre-a-api-serverest)
- [Estrutura do Projeto](#-estrutura-do-projeto)
- [PrÃ©-requisitos](#-prÃ©-requisitos)
- [InstalaÃ§Ã£o](#-instalaÃ§Ã£o)
- [Executando os Testes](#-executando-os-testes)
- [Exemplos de Testes](#-exemplos-de-testes)
- [Funcionalidades do Playwright](#-funcionalidades-do-playwright)
- [RelatÃ³rios](#-relatÃ³rios)
- [Boas PrÃ¡ticas](#-boas-prÃ¡ticas)
- [Recursos Adicionais](#-recursos-adicionais)

---

## ğŸ§ª Sobre o Playwright

**Playwright** Ã© um framework open-source da Microsoft, conhecido por testes E2E em browser e tambÃ©m por uma API robusta para testes HTTP via `APIRequestContext`, ideal para automaÃ§Ã£o de APIs em Java.

### âœ¨ Principais CaracterÃ­sticas

- **ğŸ”¥ APIRequestContext fluente**: RequisiÃ§Ãµes HTTP com `get`, `post`, `put`, `delete`
- **ğŸš€ Suporte completo a REST**: operaÃ§Ãµes GET, POST, PUT, PATCH e DELETE com JSON
- **ğŸ¯ Assertions com JUnit 5**: validaÃ§Ãµes claras e objetivas
- **ğŸ”„ Contexto reutilizÃ¡vel**: configuraÃ§Ã£o de `baseURL`, headers e ciclo de vida centralizado
- **ğŸ“Š IntegraÃ§Ã£o com Allure**: relatÃ³rios de execuÃ§Ã£o com JUnit 5
- **ğŸ§ª Data-Driven Testing**: suporte com `@CsvFileSource`, `@ValueSource`, `@ParameterizedTest`
- **âš¡ ExecuÃ§Ã£o Paralela**: suporte via JUnit 5 (`@Execution(CONCURRENT)`) + Surefire
- **ğŸ” AutenticaÃ§Ã£o**: suporte total para tokens e headers customizados

### ğŸ’¡ Por que usar Playwright para API?

1. **PadronizaÃ§Ã£o**: mesmo framework para API e UI quando necessÃ¡rio
2. **Confiabilidade**: cliente HTTP moderno e estÃ¡vel
3. **IntegraÃ§Ã£o**: funciona naturalmente com Maven + JUnit 5
4. **EvoluÃ§Ã£o**: ecossistema ativo e muito bem documentado
5. **CI/CD**: fÃ¡cil integraÃ§Ã£o com GitHub Actions

---

## ğŸŒ Sobre a API ServeRest

[ServeRest](https://serverest.dev/) Ã© uma API REST gratuita que simula uma loja virtual para fins educacionais e prÃ¡tica de testes de API.

### ğŸ›ï¸ Endpoints DisponÃ­veis

| Recurso | Endpoints | DescriÃ§Ã£o |
|---------|-----------|-----------|
| **Login** | `POST /login` | AutenticaÃ§Ã£o de usuÃ¡rios |
| **UsuÃ¡rios** | `GET, POST, PUT, DELETE /usuarios` | Gerenciamento de usuÃ¡rios |
| **Produtos** | `GET, POST, PUT, DELETE /produtos` | Gerenciamento de produtos (requer admin) |
| **Carrinhos** | `GET, POST, DELETE /carrinhos` | Gerenciamento de carrinhos de compras |

### ğŸ”— Base URL

```
https://serverest.dev
```

### ğŸ“– DocumentaÃ§Ã£o Completa

- **Swagger UI**: https://serverest.dev/
- **RepositÃ³rio**: https://github.com/ServeRest/ServeRest
- **Front-end (Beta)**: https://front.serverest.dev/

---

## ğŸ“ Estrutura do Projeto

```
karate_api_java/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â””â”€â”€ java/                         # (vazio neste projeto)
â”‚   â”‚
â”‚   â””â”€â”€ test/
â”‚       â”œâ”€â”€ java/
â”‚       â”‚   â””â”€â”€ playwright_serverest/
â”‚       â”‚       â”œâ”€â”€ BaseApiTest.java
â”‚       â”‚       â”œâ”€â”€ ExecutionBuilderRunner.java
â”‚       â”‚       â”œâ”€â”€ login/
â”‚       â”‚       â”‚   â””â”€â”€ LoginPlaywrightTest.java
â”‚       â”‚       â”œâ”€â”€ usuarios/
â”‚       â”‚       â”‚   â””â”€â”€ UsersPlaywrightTest.java
â”‚       â”‚       â”œâ”€â”€ produtos/
â”‚       â”‚       â”‚   â””â”€â”€ ProductsPlaywrightTest.java
â”‚       â”‚       â”œâ”€â”€ carrinhos/
â”‚       â”‚       â”‚   â””â”€â”€ CartsPlaywrightTest.java
â”‚       â”‚       â””â”€â”€ utils/
â”‚       â”‚           â””â”€â”€ FakerUtils.java
â”‚       â”‚
â”‚       â””â”€â”€ resources/
â”‚           â”œâ”€â”€ playwright/
â”‚           â”‚   â””â”€â”€ login/
â”‚           â”‚       â”œâ”€â”€ invalid-login-emails.csv
â”‚           â”‚       â””â”€â”€ invalido-login.csv
â”‚           â””â”€â”€ serverest/
â”‚               â”œâ”€â”€ usuarios/resources/userPayload.json
â”‚               â””â”€â”€ produtos/resources/productPayload.json
â”‚
â”œâ”€â”€ pom.xml                               # DependÃªncias Maven
â””â”€â”€ readme-playwright.MD                  # Este arquivo
```

---

## ğŸ”§ PrÃ©-requisitos

- **Java JDK 21** (LTS) ou superior
- **Maven 3.6+**
- **IDE** (IntelliJ IDEA, Eclipse, VS Code)
- ConexÃ£o com internet (para acessar a API ServeRest)

### Download do Java 21

- Oracle JDK 21: https://www.oracle.com/java/technologies/downloads/#java21

### Verificar instalaÃ§Ã£o

```bash
java -version
mvn -version
```

---

## ğŸ“¦ VersÃµes das dependÃªncias (pom.xml)

| Componente                         | Artefato                                           | VersÃ£o  |
|------------------------------------|----------------------------------------------------|---------|
| Playwright Java                    | com.microsoft.playwright:playwright                | 1.49.0  |
| JUnit 5 (Jupiter API)             | org.junit.jupiter:junit-jupiter-api                | 5.10.1  |
| JUnit 5 (Jupiter Engine)          | org.junit.jupiter:junit-jupiter-engine             | 5.10.1  |
| JUnit 5 (Jupiter Params)          | org.junit.jupiter:junit-jupiter-params             | 5.10.1  |
| Jackson Databind                   | com.fasterxml.jackson.core:jackson-databind        | 2.17.0  |
| Java Faker                         | com.github.javafaker:javafaker                     | 1.0.2   |
| Hamcrest                           | org.hamcrest:hamcrest                              | 2.2     |
| Maven Surefire Plugin             | org.apache.maven.plugins:maven-surefire-plugin     | 3.2.5   |
| Allure JUnit5                      | io.qameta.allure:allure-junit5                     | 2.17.0  |

---

## ğŸš€ InstalaÃ§Ã£o

### 1. Clone o repositÃ³rio

```bash
git clone https://github.com/reinaldorossetti/karate_api_java.git
cd karate_api_java
```

### 2. Instale as dependÃªncias

```bash
mvn -q test-compile
mvn clean install
```

### 3. Verifique a instalaÃ§Ã£o

```bash
mvn test
```

---

## â–¶ï¸ Executando os Testes

### Executar todos os testes do mÃ³dulo Playwright

```bash
mvn clean test -Dtest=playwright_serverest.**.*Test
```

### Executar suÃ­te completa Playwright

```bash
mvn -Dtest=playwright_serverest.ExecutionBuilderRunner test
```

### Executar suÃ­te de login

```bash
mvn -Dtest=playwright_serverest.login.LoginPlaywrightTest test
```

### Executar mÃ©todo especÃ­fico

```bash
mvn -Dtest=playwright_serverest.login.LoginPlaywrightTest#ct01_loginWithValidCredentials test
```

### ExecuÃ§Ã£o paralela (JUnit 5)

Arquivo: `junit-platform.properties`

```properties
junit.jupiter.execution.parallel.enabled=true
junit.jupiter.execution.parallel.mode.default=concurrent
junit.jupiter.execution.parallel.mode.classes.default=concurrent
junit.jupiter.execution.parallel.config.strategy=dynamic
junit.jupiter.execution.parallel.config.dynamic.factor=2
```

---

## âš™ï¸ Esteira CI/CD - GitHub Actions

Este projeto possui integraÃ§Ã£o contÃ­nua configurada no GitHub Actions em:

- Arquivo: `.github/workflows/api-tests.yml`

### ğŸ” Quando a esteira Ã© executada

- `push` em qualquer branch
- `pull_request` aberto ou atualizado

### ğŸ§± Passos principais do job `test`

1. **Checkout do cÃ³digo**
   - `actions/checkout@v4`
2. **ConfiguraÃ§Ã£o do Java 21**
   - `actions/setup-java@v5` com:
     - `java-version: '21'`
     - `distribution: 'temurin'`
3. **ExecuÃ§Ã£o dos testes via Maven**
   - Comando sugerido para Playwright API: `mvn clean -Dtest=playwright_serverest.ExecutionBuilderRunner test`
4. **PublicaÃ§Ã£o de relatÃ³rios Allure**
   - Publica `target/allure-report` via `peaceiris/actions-gh-pages@v4` na branch `gh-pages`, pasta `allure-reports`.

### ğŸŒ Acesso ao relatÃ³rio no GitHub Pages

ApÃ³s a execuÃ§Ã£o da esteira:

- URL do relatÃ³rio:
  - `https://reinaldorossetti.github.io/karate_api_java/allure-reports/index.html`

---

## ğŸ“ Exemplos de Testes

### Exemplo 1: ConfiguraÃ§Ã£o Base (BaseApiTest)

```java
public abstract class BaseApiTest {

    protected static final String BASE_URL = "https://serverest.dev";
    protected Playwright playwright;
    protected APIRequestContext request;

    @BeforeAll
    void setupPlaywright() {
        playwright = Playwright.create();
        request = playwright.request().newContext(
            new APIRequest.NewContextOptions().setBaseURL(BASE_URL)
        );
    }

    @AfterAll
    void teardownPlaywright() {
        if (request != null) request.dispose();
        if (playwright != null) playwright.close();
    }
}
```

### Exemplo 2: Login com sucesso

```java
@Test
@DisplayName("CT01 - Perform login with valid credentials and validate token")
void ct01_loginWithValidCredentials() throws Exception {
    String email = FakerUtils.randomEmail();
    String password = "SenhaSegura@123";

    request.post("/usuarios", RequestOptions.create()
        .setHeader("Content-Type", "application/json")
        .setData("{\"nome\":\"Teste\",\"email\":\"" + email + "\",\"password\":\"" + password + "\",\"administrador\":\"true\"}"));

    APIResponse loginResp = request.post("/login", RequestOptions.create()
        .setHeader("Content-Type", "application/json")
        .setData("{\"email\":\"" + email + "\",\"password\":\"" + password + "\"}"));

    assertEquals(200, loginResp.status());
}
```

### Exemplo 3: Login invÃ¡lido

```java
@Test
@DisplayName("CT02 - Attempt login with invalid credentials")
void ct02_loginWithInvalidCredentials() throws Exception {
    APIResponse resp = request.post("/login", RequestOptions.create()
        .setHeader("Content-Type", "application/json")
        .setData("{\"email\":\"invalido@teste.com\",\"password\":\"senhaerrada\"}"));

    assertEquals(401, resp.status());
}
```

### Exemplo 4: ValidaÃ§Ã£o de campos obrigatÃ³rios

```java
@Test
@DisplayName("CT03 - Validate required fields on login")
void ct03_validateRequiredFields() {
    APIResponse resp = request.post("/login", RequestOptions.create()
        .setHeader("Content-Type", "application/json")
        .setData("{\"email\":\"\",\"password\":\"senha123\"}"));

    assertEquals(400, resp.status());
}
```

### Exemplo 5: Uso do token em rota protegida

```java
@Test
@DisplayName("CT04 - Login and use token to access a protected resource")
void ct04_loginAndUseTokenInProtectedRoute() throws Exception {
    String token = "...";

    APIResponse resp = request.post("/produtos", RequestOptions.create()
        .setHeader("Content-Type", "application/json")
        .setHeader("Authorization", token)
        .setData("{\"nome\":\"Produto Teste\",\"preco\":100,\"descricao\":\"Teste\",\"quantidade\":10}"));

    assertEquals(403, resp.status());
}
```

### Exemplo 6: Teste parametrizado com CSV

```java
@ParameterizedTest(name = "CT05 - Email invÃ¡lido: {0}")
@CsvFileSource(resources = "/playwright/login/invalid-login-emails.csv", numLinesToSkip = 1)
@Execution(ExecutionMode.CONCURRENT)
@DisplayName("CT05 - Validate invalid email format")
void ct05_validateInvalidEmailFormat(String invalidEmail) {
    APIResponse resp = request.post("/login", RequestOptions.create()
        .setHeader("Content-Type", "application/json")
        .setData("{\"email\":\"" + invalidEmail + "\",\"password\":\"senha123\"}"));

    assertEquals(400, resp.status());
}
```

### Arquivo CSV utilizado no CT05

`src/test/resources/playwright/login/invalid-login-emails.csv`

```csv
email
emailwithoutat
@noname.com
email@nodomain
email
12345@test.c
!@#$%
```

---

## ğŸ¯ Funcionalidades do Playwright

### 1. Contexto reutilizÃ¡vel de API

```java
APIRequestContext request = playwright.request().newContext(
    new APIRequest.NewContextOptions().setBaseURL("https://serverest.dev")
);
```

### 2. RequisiÃ§Ãµes HTTP com RequestOptions

```java
APIResponse response = request.post("/login", RequestOptions.create()
    .setHeader("Content-Type", "application/json")
    .setData(payload));
```

### 3. ExtraÃ§Ã£o e parsing de resposta

```java
Map<String, Object> body = objectMapper.readValue(response.body(), Map.class);
String token = (String) body.get("authorization");
int status = response.status();
```

### 4. VariÃ¡veis e ReutilizaÃ§Ã£o

```java
String email = FakerUtils.randomEmail();
String product = FakerUtils.randomProduct();

String payload = String.format("{\"email\":\"%s\",\"password\":\"%s\"}", email, password);
```

### 5. Hooks e Setup com JUnit 5

```java
@TestInstance(Lifecycle.PER_CLASS)
@Execution(ExecutionMode.CONCURRENT)
public class LoginPlaywrightTest extends BaseApiTest {
    // setup e teardown herdados de BaseApiTest
}
```

---

## ğŸ“Š RelatÃ³rios

ApÃ³s executar os testes, relatÃ³rios Allure podem ser gerados em:

```
target/allure-report/index.html
```

Para gerar e abrir o relatÃ³rio localmente:

```bash
mvn allure:serve
```

O relatÃ³rio exibe:
- âœ… Testes executados, passados e falhos
- â±ï¸ Tempo de execuÃ§Ã£o por teste
- ğŸ“‹ Resultado de requisiÃ§Ãµes e respostas
- ğŸ“Š HistÃ³rico de execuÃ§Ãµes

---

## ğŸ“ Boas PrÃ¡ticas

### 1. OrganizaÃ§Ã£o das Classes de Teste

- âœ… Uma classe por recurso (`LoginPlaywrightTest`, `UsersPlaywrightTest`)
- âœ… Use `BaseApiTest` para configuraÃ§Ãµes comuns
- âœ… Nomeie os mÃ©todos de forma descritiva com prefixo `ct0X_`

### 2. AnotaÃ§Ãµes para OrganizaÃ§Ã£o

```java
@Tag("smoke")
@Tag("regression")
@Tag("login")
@Disabled
```

### 3. ReutilizaÃ§Ã£o de CÃ³digo

- âœ… Crie mÃ©todos helper (ex: `createUser()`, `getAdminToken()`, `createProduct()`)
- âœ… Centralize setup e teardown em `BaseApiTest`
- âœ… Centralize geraÃ§Ã£o de dados no `FakerUtils`

### 4. Dados de Teste

```java
String email = FakerUtils.randomEmail();
String product = FakerUtils.randomProduct() + System.currentTimeMillis();
```

### 5. ValidaÃ§Ãµes Completas

```java
assertEquals(200, response.status());
assertNotNull(body.get("authorization"));
assertEquals("Login realizado com sucesso", body.get("message"));
```

---

## ğŸ“š Recursos Adicionais

### DocumentaÃ§Ã£o Oficial

- ğŸ­ **Playwright Java**: https://playwright.dev/java/docs/intro
- ğŸŒ **ServeRest**: https://serverest.dev/
- â˜• **JUnit 5**: https://junit.org/junit5/
- ğŸ“Š **Allure**: https://docs.qameta.io/allure/

### Tutoriais e Cursos

- [Playwright Java APIRequestContext](https://playwright.dev/java/docs/api/class-apirequestcontext)
- [JUnit 5 User Guide](https://junit.org/junit5/docs/current/user-guide/)
- [ServeRest GitHub](https://github.com/ServeRest/ServeRest)

### Comunidade

- [Stack Overflow - Playwright Tag](https://stackoverflow.com/questions/tagged/playwright)
- [Playwright GitHub Issues](https://github.com/microsoft/playwright/issues)

---

## ğŸ¤ Contribuindo

ContribuiÃ§Ãµes sÃ£o bem-vindas! Para contribuir:

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/MinhaFeature`)
3. Commit suas mudanÃ§as (`git commit -m 'Adiciona nova feature'`)
4. Push para a branch (`git push origin feature/MinhaFeature`)
5. Abra um Pull Request

---

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ sob a licenÃ§a MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

---

## ğŸ‘¨â€ğŸ’» Autor

Desenvolvido para fins de estudo e prÃ¡tica de automaÃ§Ã£o de testes de API.

---

## â­ Agradecimentos

- **Microsoft** - Criadora do Playwright
- **Paulo GonÃ§alves** - Criador da API ServeRest
- Comunidade open-source

---

ReferÃªncias:
- https://playwright.dev/java/docs/intro
- https://junit.org/junit5/
- https://github.com/microsoft/playwright

**ğŸš€ Happy Testing with Playwright!** ğŸ­
